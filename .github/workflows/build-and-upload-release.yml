# Copyright Amazon.com, Inc. or its affiliates. All Rights Reserved.
# SPDX-License-Identifier: Apache-2.0

name: Build And Upload Artifact
env:
  # Use terraform assume role for uploading to ecr
  AWS_ASSUME_ROLE: ${{ secrets.TERRAFORM_AWS_ASSUME_ROLE }}
  ECR_OPERATOR_STAGING_REPO: ${{ vars.ECR_OPERATOR_STAGING_REPO }}
  ECR_OPERATOR_RELEASE_IMAGE: ${{ vars.ECR_OPERATOR_RELEASE_IMAGE }}

on:
  workflow_dispatch:
    inputs:
      release:
        description: 'Release Artifact'
        required: false
        default: false
        type: boolean
      tag:
        description: 'Staging Artifact Tag'
        required: false
        default: 'staging'
        type: string
  workflow_call:
    inputs:
      release:
        description: 'Release Artifact'
        required: false
        default: false
        type: boolean
      tag:
        description: 'Staging Artifact Tag'
        required: false
        default: 'integration'
        type: string

jobs:
  BuildAndUpload:
    uses: ./.github/workflows/build-and-upload.yml
    secrets: inherit
    with:
      tag: ${{inputs.tag}}